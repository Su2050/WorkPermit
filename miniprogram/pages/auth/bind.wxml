<!--pages/auth/bind.wxml-->
<view class="page">
  <view class="container">
    <!-- 步骤1: 微信授权 -->
    <view wx:if="{{step === 1}}" class="step-content">
      <view class="header">
        <image class="logo" src="/assets/images/logo.png" mode="aspectFit" />
        <text class="title">欢迎使用</text>
        <text class="subtitle">作业票培训系统</text>
      </view>

      <view class="info-box card">
        <view class="info-item">
          <text class="info-icon">🔒</text>
          <text class="info-text">我们将获取您的微信信息用于身份识别</text>
        </view>
        <view class="info-item">
          <text class="info-icon">📱</text>
          <text class="info-text">您的信息将被安全加密保护</text>
        </view>
      </view>

      <button 
        class="btn btn-primary btn-block" 
        bindtap="wxLogin"
        loading="{{loading}}"
        disabled="{{loading}}"
      >
        微信一键登录
      </button>
    </view>

    <!-- 步骤2: 身份验证 -->
    <view wx:else class="step-content">
      <view class="header-sm">
        <text class="title">身份验证</text>
        <text class="subtitle">请填写您的真实信息进行身份验证</text>
      </view>

      <view class="form-card card">
        <view class="input-group">
          <text class="input-label">姓名</text>
          <input 
            class="input" 
            placeholder="请输入您的真实姓名"
            placeholder-class="input-placeholder"
            value="{{form.name}}"
            data-field="name"
            bindinput="onInputChange"
          />
        </view>

        <view class="input-group">
          <text class="input-label">身份证号</text>
          <input 
            class="input" 
            placeholder="请输入18位身份证号"
            placeholder-class="input-placeholder"
            maxlength="18"
            value="{{form.idCard}}"
            data-field="idCard"
            bindinput="onInputChange"
          />
        </view>

        <view class="input-group">
          <text class="input-label">手机号</text>
          <view class="phone-input-wrap">
            <input 
              class="input phone-input" 
              type="number"
              placeholder="请输入手机号"
              placeholder-class="input-placeholder"
              maxlength="11"
              value="{{form.phone}}"
              data-field="phone"
              bindinput="onInputChange"
            />
            <button 
              class="get-phone-btn"
              open-type="getPhoneNumber"
              bindgetphonenumber="getPhoneNumber"
            >
              快捷获取
            </button>
          </view>
        </view>
      </view>

      <view class="agreement">
        <checkbox-group bindchange="onAgreeChange">
          <label class="agreement-label">
            <checkbox value="agreed" checked="{{agreed}}" />
            <text class="agreement-text">
              我已阅读并同意
              <text class="link">《用户服务协议》</text>
              和
              <text class="link">《隐私政策》</text>
            </text>
          </label>
        </checkbox-group>
      </view>

      <button 
        class="btn btn-primary btn-block" 
        bindtap="submitBind"
        loading="{{loading}}"
        disabled="{{loading || !agreed}}"
      >
        提交验证
      </button>

      <view class="tips">
        <text class="tips-text">请确保填写的信息与工地登记信息一致</text>
      </view>
    </view>
  </view>
</view>

